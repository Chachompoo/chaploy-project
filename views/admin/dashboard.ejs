<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Chaploy</title>
  <link rel="stylesheet" href="/stylesheets/admin.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --card-radius:20px;
      --shadow:0 12px 30px rgba(31,38,135,.12);
      --bg:#f6f8fd;
      --text:#1f2937;
      --muted:#6b7280;

      /* palette */
      --green-1:#00C49F; --green-2:#86F5DB;
      --purple-1:#6C63FF; --purple-2:#9EA6FF;
      --yellow-1:#F6C23E; --yellow-2:#FFE194;
      --red-1:#FF6B6B; --red-2:#FF9E9E;
    }

    body{background:var(--bg);}
    .dashboard-wrap{padding:28px; max-width:1200px; margin:0 auto;}
    .topgrid{
      display:grid; gap:16px;
      grid-template-columns: repeat(4,minmax(0,1fr));
      margin-bottom:22px;
    }
    .kpi{
      border-radius:18px; color:#fff; padding:18px 18px 16px;
      box-shadow:var(--shadow); position:relative; overflow:hidden;
    }
    .kpi .val{font-size:28px; font-weight:800; margin:10px 0 4px}
    .kpi .label{font-size:14px; opacity:.95}
    .kpi .delta{position:absolute; right:14px; bottom:12px; font-size:12px; background:rgba(255,255,255,.18); padding:4px 8px; border-radius:999px}

    .g-green { background: linear-gradient(135deg, var(--green-2), var(--green-1)); }
    .g-purple{ background: linear-gradient(135deg, var(--purple-2), var(--purple-1));}
    .g-yellow{ background: linear-gradient(135deg, var(--yellow-2), var(--yellow-1));}
    .g-red   { background: linear-gradient(135deg, var(--red-2), var(--red-1));}

    .main{
      display:grid; gap:20px; grid-template-columns: 7fr 4fr;
    }
    .panel{
      background:#fff; border-radius:20px; box-shadow:var(--shadow); padding:18px;
    }
    .panel h3{margin:6px 0 14px; color:var(--text); font-size:16px;}

    .sales-total{display:flex; align-items:center; justify-content:space-between; margin-bottom:6px}
    .sales-total .big{font-size:22px; font-weight:800}
    .sales-total .range{font-size:13px; color:var(--muted)}

    table{width:100%; border-collapse:collapse; font-size:14px;}
    thead th{color:#9aa3b2; font-weight:700; text-align:left; padding:10px 6px;}
    tbody td{padding:12px 6px; border-top:1px solid #f1f3f8;}
    tr:hover{background:#fafbff;}
    .id{color:#9aa3b2; font-weight:700}
    .row{display:flex; align-items:center; gap:10px; padding:6px 8px;}
    .avatar{
      width:34px; height:34px; border-radius:50%; display:grid; place-items:center;
      color:#fff; font-weight:800; font-size:14px;
      background: linear-gradient(135deg,#9EA6FF,#6C63FF);
      box-shadow:0 6px 16px rgba(108,99,255,.25);
    }
    .name{font-weight:700; color:#374151}

    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á */
    .status-tag {
      display:inline-block;
      padding:4px 10px;
      border-radius:8px;
      font-size:0.85rem;
      font-weight:600;
      color:#fff;
      text-transform:capitalize;
    }
    .status-tag.pending { background:#f1c40f; }
    .status-tag.confirmed { background:#3498db; }
    .status-tag.shipped { background:#f39c12; }
    .status-tag.delivered { background:#27ae60; }
    .status-tag.cancelled { background:#e74c3c; }

    .legend{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:10px}
    .legend span{display:flex; gap:8px; align-items:center; color:#6b7280; font-size:13px}
    .dot{
      width:10px; height:10px; border-radius:50%;
      display:inline-block;
    }

    .pdf{
      margin-top:18px; padding:18px; border-radius:18px; background:#f7f2ff;
      display:flex; flex-direction:column; gap:10px; text-align:center;
    }
    .pdf h4{margin:0; color:#3b3b66}
    .btn{
      border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700;
      background: linear-gradient(135deg, #C6C6FF, #6C63FF); color:#fff;
      box-shadow:0 8px 22px rgba(108,99,255,.3);
    }
    .btn:hover{opacity:.95}

    @media (max-width:1100px){
      .topgrid{grid-template-columns:repeat(2,minmax(0,1fr));}
      .main{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <%- include('../partials/admin_navbar') %>

  <div class="dashboard-wrap">
    <!-- KPI -->
    <div class="topgrid">
      <div class="kpi g-green">
        <div class="val"><%= summary.dailyVisitors || 0 %></div>
        <div class="label">Daily Visitors</div>
        <div class="delta">+<%= kpi.visitorGrowth %>%</div>
      </div>
      <div class="kpi g-purple">
        <div class="val"><%= summary.totalOrders || 0 %></div>
        <div class="label">Total Orders</div>
        <div class="delta">+0%</div>
      </div>
      <div class="kpi g-yellow">
        <div class="val">‡∏ø<%= (summary.totalSales||0).toLocaleString() %></div>
        <div class="label">Total Sales</div>
        <div class="delta">+0%</div>
      </div>
      <div class="kpi g-red">
        <div class="val">‡∏ø<%= (summary.totalProfit||0).toLocaleString() %></div>
        <div class="label">Total Profit</div>
        <div class="delta">+0%</div>
      </div>
    </div>

    <div class="main">
      <!-- LEFT -->
      <div class="panel">
        <div class="sales-total">
          <div class="big">Total Sales ‡∏ø<%= (summary.totalSales||0).toLocaleString() %></div>
          <div class="range">This Year</div>
        </div>
        <canvas id="salesLine"></canvas>

        <h3 style="margin-top:18px;">Recent Order</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Name</th><th>Date</th><th>Price</th><th>Status</th>
            </tr>
          </thead>
          <tbody>
          <% if (recentOrders && recentOrders.length){ %>
            <% recentOrders.forEach(o=>{ %>
              <tr>
                <td class="id"><%= o.id %></td>
                <td>
                  <div class="row">
                    <div class="avatar"><%= o.customer_name ? o.customer_name.charAt(0).toUpperCase() : 'U' %></div>
                    <div class="name"><%= o.customer_name %></div>
                  </div>
                </td>
                <td><%= o.date %></td>
                <td>‡∏ø<%= Number(o.total||0).toLocaleString() %></td>
                <td>
                  <span class="status-tag <%= o.order_status.toLowerCase() %>">
                    <%= o.order_status %>
                  </span>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="5" style="text-align:center;color:#9aa3b2;">No orders found</td></tr>
          <% } %>
          </tbody>
        </table>
      </div>

      <!-- RIGHT -->
      <div class="panel">
        <h3>Sale Status</h3>
        <canvas id="statusDoughnut"></canvas>
        <div class="legend">
          <span><span class="dot" style="background:#f1c40f"></span> Pending</span>
          <span><span class="dot" style="background:#3498db"></span> Confirmed</span>
          <span><span class="dot" style="background:#f39c12"></span> Shipped</span>
          <span><span class="dot" style="background:#27ae60"></span> Delivered</span>
          <span><span class="dot" style="background:#e74c3c"></span> Cancelled</span>
        </div>

        <div class="pdf">
          <h4>PDF Report</h4>
          <div style="color:#6b6b93; font-size:13px;">Download Monthly Reports</div>
          <button class="btn" onclick="location.href='/admin/reports/sales'">
            <i class="fas fa-download"></i> Download
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <script>
    // üìà Line chart (Sales)
    const lineCtx = document.getElementById('salesLine');
    new Chart(lineCtx, {
      type: 'line',
      data: {
        labels: <%- JSON.stringify(chartData.salesMonths) %>,
        datasets: [{
          data: <%- JSON.stringify(chartData.salesValues) %>,
          borderColor: '#6C63FF',
          backgroundColor: (ctx)=>{
            const {chart} = ctx;
            const g = chart.ctx.createLinearGradient(0,0,0,180);
            g.addColorStop(0,'rgba(108,99,255,.25)');
            g.addColorStop(1,'rgba(108,99,255,0)');
            return g;
          },
          fill: true,
          pointBackgroundColor:'#6C63FF',
          pointRadius:4,
          pointHoverRadius:6,
          tension:.4,
          borderWidth:3
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{
          y:{grid:{color:'rgba(0,0,0,.05)'}},
          x:{grid:{display:false}}
        },
        maintainAspectRatio:true
      }
    });

    // üç© Doughnut Chart (order_status ‡∏à‡∏£‡∏¥‡∏á)
    const doughCtx = document.getElementById('statusDoughnut');
    new Chart(doughCtx, {
      type:'doughnut',
      data:{
        labels: <%- JSON.stringify(chartData.statusLabels) %>,
        datasets:[{
          data: <%- JSON.stringify(chartData.statusValues) %>,
          backgroundColor:[
            '#f1c40f', // pending
            '#3498db', // confirmed
            '#f39c12', // shipped
            '#27ae60', // delivered
            '#e74c3c'  // cancelled
          ],
          borderWidth:0
        }]
      },
      options:{plugins:{legend:{display:false}}}
    });
  </script>

  <script src="https://kit.fontawesome.com/a2e0e6d18b.js" crossorigin="anonymous"></script>
</body>
</html>
