<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/navbar.css" />
  <link rel="stylesheet" href="/stylesheets/basket.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .checkout-wrapper{max-width:960px;margin:40px auto;background:#fff;padding:24px;border-radius:14px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:24px}
    .card{border:1px solid #eee;border-radius:12px;padding:16px}
    .card h3{margin:0 0 12px 0;font-weight:600;letter-spacing:.5px}
    .field{display:flex;flex-direction:column;margin-bottom:12px}
    .field label{font-size:.9rem;margin-bottom:6px;opacity:.8}
    .field input, .field textarea{padding:10px;border:1px solid #ddd;border-radius:10px}
    .order-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}
    .order-row:last-child{border-bottom:0}
    .total{display:flex;justify-content:space-between;font-weight:700;margin-top:12px}
    .btn-primary{background:#000;color:#fff;border:none;border-radius:12px;padding:12px 16px;cursor:pointer;width:100%}
    .muted{opacity:.7}
  </style>
</head>
<body>
  <%- include('../partials/navbar') %>

  <div class="checkout-wrapper">
    <h2>Payment</h2>
    <div class="grid">
      <div class="card">
        <h3>Billing & Shipping</h3>
        <form id="payForm" action="/shop/checkout" method="POST" enctype="multipart/form-data">
          <div class="field">
            <label>Shipping address</label>
            <textarea name="address" rows="3" required></textarea>
          </div>
          <div class="field">
            <label>Phone</label>
            <input name="phone" required />
          </div>
          <div class="field">
            <label>Email (we’ll send the receipt here)</label>
            <input type="email" name="email" required />
          </div>
          <div class="field">
            <label>Upload bank slip (.jpg/.png/.pdf)</label>
            <input type="file" name="slip" accept=".jpg,.jpeg,.png,.pdf" required />
          </div>

          <button class="btn-primary" type="submit">Confirm Payment</button>
        </form>
      </div>

      <div class="card">
        <h3>Order Summary</h3>
        <% cart.forEach(item => { %>
          <div class="order-row">
            <span><%= item.name %> × <%= item.qty %></span>
            <span>$<%= (Number(item.price)*Number(item.qty)).toFixed(2) %></span>
          </div>
        <% }) %>
        <div class="order-row muted">
          <span>Subtotal</span>
          <span>$<%= subtotal.toFixed(2) %></span>
        </div>
        <div class="order-row muted">
          <span>Shipping</span>
          <span>$<%= shippingFee.toFixed(2) %></span>
        </div>
        <div class="total">
          <span>Total</span>
          <span>$<%= total.toFixed(2) %></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // แจ้งเตือนสั้น ๆ ก่อน submit (ไม่บล็อก)
    document.getElementById('payForm').addEventListener('submit', (e)=>{
      Swal.fire({title:'Submitting...',text:'Please wait while we save your order.',toast:true,position:'top-end',showConfirmButton:false,timer:1500});
    });
  </script>
</body>
</html>
